function $(n){return document.querySelector(n)}function $$(n){return document.querySelectorAll(n)}function renderBlock(n){n.forEach(function(n,t){var e=t+1;n.forEach(function(n,t){ctx.fillRect(n*block.width,e*block.height,block.width,block.height)})})}function Point(n){this.X=n[0],this.Y=n[1],this.parents=0}var openList=function(){var n=[];return{add:function(t){n.push(t)},count:function(){return n.length},minPoint:function(){if(this.count()>1){var t=n[0].calF();return n.forEach(function(n,e){t>n.calF()&&(t=n.calF())}),t}return n},removeAt:function(t){n.splice(t,1)},exists:function(){},lookArr:function(){console.log(n[0].calF())}}}(),closeList=function(){var n=[];return{add:function(t){n.push(t)}}}(),roadArr=[],findPath=function(n,t){for(openList.add(n);0!==openList.count();){var e=openList.minPoint(),o=sAroundPoints(e);openList.removeAt(0),closeList.add(e),o.forEach(function(n,o){openList.exists(n)?FoundPoint(e,point):NotFoundPoint(e,t,point)});break}},sAroundPoints=function(n){var t=n[0].x,e=n[0].y;return[{x:t-1,y:e},{x:t-1,y:e-1},{x:t-1,y:e+1},{x:t+1,y:e},{x:t+1,y:e-1},{x:t+1,y:e+1},{x:t,y:e-1},{x:t,y:e+1}]},eventUtil={addHandler:function(n,t,e){n.addEventListener?n.addEventListener(t,e,!1):n.attachEvent?n.attachEvent("on"+t,e):n["on"+t]=e},removeHandler:function(n,t,e){n.removeEventListener?n.removeEventListener(t,e,!1):n.detachEvent?n.detachEvent("on"+t,e):n["on"+t]=null}},canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=320,canvas.height=560,document.body.appendChild(canvas);var kingsMan={speed:256,x:180,y:20,sx:4,sy:0,flag:1},endPoint={x:0,y:0},block={width:40,height:40},cooX=[[0,40],[40,80],[80,120],[120,160],[160,200],[200,240],[240,280],[280,320]],cooY=[[0,40],[40,80],[80,120],[120,160],[160,200],[200,240],[240,280],[280,320],[320,360],[360,400],[400,440],[440,480],[480,520],[520,560]],wallBlockArr=[],stageNum=0,keysDown={},targetBlock;eventUtil.addHandler($("canvas"),"click",function(n){targetBlock=calTargetBlock(n.offsetX,n.offsetY),console.log(targetBlock),findPath({x:kingsMan.sx,y:kingsMan.sy,flag:kingsMan.flag},targetBlock)},!1),eventUtil.addHandler(window,"keydown",function(n){keysDown[n.keyCode]=!0},!1),eventUtil.addHandler(window,"keyup",function(n){delete keysDown[n.keyCode]},!1);var calTargetBlock=function(n,t){var e,o,i={};return cooX.forEach(function(t,o){n>t[0]&&n<t[1]&&(e=o,i.x=e)}),cooY.forEach(function(n,e){t>n[0]&&t<n[1]&&(o=e,i.y=o)}),i},reset=function(){wallBlockArr=createBlock(13,2),console.log(wallBlockArr)},createBlock=function(n,t){for(var e=[],o=1;n>o;o++){for(var i=[],a=0;t>a;a++){var c=Math.floor(8*Math.random());i.push(c)}e.push(i)}return e},update=function(n){38 in keysDown&&(kingsMan.y-=kingsMan.speed*n),40 in keysDown&&(kingsMan.y+=kingsMan.speed*n),37 in keysDown&&(kingsMan.x-=kingsMan.speed*n),39 in keysDown&&(kingsMan.x+=kingsMan.speed*n),kingsMan.x<=endPoint.x+32&&endPoint.x<=kingsMan.x+32&&kingsMan.y<=endPoint.y+32&&endPoint.y<=kingsMan.y+32&&(++stageNum,reset())},render=function(){ctx.fillStyle="#FFE6CD",ctx.fillRect(0,0,320,560),ctx.beginPath(),ctx.arc(kingsMan.x,kingsMan.y,20,0,2*Math.PI),ctx.fillStyle="#44B811",ctx.fill(),ctx.beginPath(),ctx.moveTo(140,560),ctx.lineTo(160,520),ctx.lineTo(120,520),ctx.fillStyle="#F4AF29",ctx.fill(),ctx.fillStyle="rgb(0, 0, 0)",ctx.font="20px Helvetica",ctx.textAlign="left",ctx.textBaseline="top",ctx.fillText("Stage: "+stageNum,10,10),ctx.fillStyle="#2E1E1E",renderBlock(wallBlockArr)},main=function(){var n=Date.now(),t=n-then;update(t/1e3),render(),then=n,requestAnimationFrame(main)},then=Date.now();reset(),main(),Point.prototype.calF=function(){var n,t,e;return e=Math.abs(targetBlock[0]-this.X)+Math.abs(targetBlock[1]-this.Y),t=Math.abs(this.parents.X-this.X)+Math.abs(this.parents.Y-this.Y),n=e+t,point};